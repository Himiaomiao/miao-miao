# Promise

## 1、Promise出现的原因

>promise出现主要是为了解决回调地狱的问题。在前端请求服务器数据中，经常出现根据前一个的请求结果去执行后一个请求，此时就出现了回调地狱。
>
>```javascript
>请求1(function(请求结果1){
>    请求2(function(请求结果2){
>        请求3(function(请求结果3){
>            请求4(function(请求结果4){
>                请求5(function(请求结果5){
>                    请求6(function(请求结果3){
>                        ...
>                    })
>                })
>            })
>        })
>    })
>})
>
>```
>
>回调地狱的缺点：
>
>+ 代码臃肿
>+ 可读性差
>+ 耦合度过高，可维护性差
>+ 代码复用性差
>+ 容易产生bug
>+ 只能在回调里处理异常。

## 2、promise概念

>Promise是异步编程的一种解决方法，主要作用是将异步转同步。
>
>通过promise处理上面的回调函数示例：
>
>```javascript
>new Promise(请求1)
>    .then(请求2(请求结果1))
>    .then(请求3(请求结果2))
>    .then(请求4(请求结果3))
>    .then(请求5(请求结果4))
>    .catch(处理异常(异常信息))
>```

## 3、如何理解Promise

```javascript
//送完饭后打电话通知我
.then((送饭结果)=>{
    电话通知我();
})
复制代码
```

至此，我通知了保姆要做这些事情，然后我就可以放心地去办我的事情。

> 请一定要谨记：如果我们的后续任务是异步任务的话，必须return 一个 新的 promise 对象。
>  如果后续任务是同步任务，只需 return 一个结果即可。
>  我们上面举的例子，除了**电话通知我**是一个同步任务，其余的都是异步任务，异步任务 return 的是 promise对象。

除此之外，一定谨记，一个 Promise 对象有三个状态，并且状态一旦改变，便不能再被更改为其他状态。

- pending，异步任务正在进行。
- resolved (也可以叫fulfilled)，异步任务执行成功。
- rejected，异步任务执行失败。

#### Promise的使用总结。

Promise 这么多概念，初学者很难一下子消化掉，那么我们可以采取强制记忆法，强迫自己去记住使用过程。

- 首先初始化一个 Promise 对象，可以通过两种方式创建， 这两种方式都会返回一个 Promise 对象。

  - 1、new Promise(fn)
  - 2、Promise.resolve(fn)

- 然后调用上一步返回的 promise 对象的 then 方法，注册回调函数。

  - then 中的回调函数可以有一个参数，也可以不带参数。如果 then 中的回调函数依赖上一步的返回结果，那么要带上参数。比如

  ```javascript
      new Promise(fn)
      .then(fn1(value）{
          //处理value
      })
  复制代码
  ```

- 最后注册 catch 异常处理函数，处理前面回调中可能抛出的异常。


作者：lucefer
链接：https://juejin.cn/post/6844903625609707534
来源：掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。